{% from '_helpers.jinja2' import button, modal, toggle_modal_options, input_modal_options, tabs, select_modal_options with context %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>y</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles/global.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles/modal.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles/awm.css') }}" />
    <script src="{{ url_for('static', filename='scripts/dist/webpack.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/main.js') }}"></script>
  </head>

  <body>
<div id="main-toolbox">
      <div id="logo-area">
        <img src="https://images.icon-icons.com/2699/PNG/512/youtube_logo_icon_168737.png"
             alt="logo"
             width="64"
             height="64" />
        <p>ytdlp frontend test</p>
      </div>
      <div id="download-area">
        <input autocomplete="off" type="text" id="url-input" placeholder="https://www.youtube.com/watch?v=..." />
        <div id="custom-button-area">
          <div class="av-wrapper" data-value="video">
            {{ button('video', selected=True, id='video-switch') }}
            {{ button('audio', id='audio-switch') }}
          </div>
          {{ button('download',
                    id='download-button',
                    outline=True) 
          }}
        </div>
      </div>
    </div>

    {% call modal('settings', visible=False, id='settings-modal', content_width='45%') %}
      {% call tabs('settings-tabs', ['yt-dlp', 'FFmpeg']) %}
        <div class="tab-pane active">
          {% set video_presets = [
            {
              "title": "Auto (1080p + Audio)",
              "value": "bestvideo[height<=1080][ext=mp4]+bestaudio[ext=m4a]/bestvideo[height<=1080][ext=mp4]/b",
              "description": "Recommended. Best video up to 1080p and best audio, requires FFmpeg."
            },
            {
              "title": "Auto (Best Combined)",
              "value": "best*[vcodec!=none][acodec!=none][height<=1080]",
              "description": "Best format with both video and audio. Does not require FFmpeg."
            },
            {
              "title": "MP4 (Video Only)",
              "value": "bestvideo[ext=mp4]",
              "description": "Highest quality MP4 video stream, likely no audio."
            },
            {
              "title": "Custom",
              "value": "custom",
              "description": "Use a custom format string entered below."
            }
          ] %}
          {% set audio_presets = [
            {
              "title": "Best Quality (M4A)",
              "value": "m4a",
              "description": "Highest quality AAC audio. Great for Apple devices."
            },
            {
              "title": "High Compatibility (MP3)",
              "value": "mp3",
              "description": "Good quality, compatible with almost everything. Requires conversion if not available."
            },
            {
              "title": "Best Quality (Opus)",
              "value": "opus",
              "description": "Excellent quality in a modern format. Requires conversion if not available."
            },
            {
              "title": "Custom",
              "value": "custom",
              "description": "Use a custom format string entered below."
            }
          ] %}
          <div id="format-selector-video">
            {{ select_modal_options(title='Video Presets', input_id='ytdl-fsl-video', presets=video_presets) }}
          </div>
          <div id="format-selector-audio" class="hidden-by-js">
            {{ select_modal_options(title='Audio Presets', input_id='ytdl-fsl-audio', presets=audio_presets) }}
          </div>
          <div id="custom-format-input-wrapper" class="hidden-by-js">
            {{ input_modal_options(title='Custom Format', input_id='ytdl-fsl-custom', description='Enter a custom yt-dlp format string.') }}
          </div>
        </div>
        <div class="tab-pane">
          {{ toggle_modal_options(title='Use FFmpeg', input_id='use-ffmpeg', description='If enabled, allows merging separate video and audio streams for higher quality. Requires a bit more processing time.') }}
        </div>
      {% endcall %}

    {% endcall %}

    {% call modal('about', visible=False, id='about-modal') %}
      <div class="about-content">
        <h2>What is this thing?</h2>
        <p>
          So, you've stumbled upon this digital marvel. What does it do? Simple. It takes those pesky video URLs you throw at it and, through a series of questionable digital gymnastics and server-side sorcery, spits out a downloadable file. It's like a vending machine, but for pixels and sound waves. We bravely proxy your request, wrestle the file from the internet's grasp, and deliver it to you, all without you having to lift more than a finger. Magic? No. Just a whole lot of code and a sprinkle of optimism.
        </p>
        <hr>
        <h2>Changelog</h2>
        <ul class="changelog-list">
          {% for pr in changelog %}
            <li>
              <a href="{{ pr.url }}" target="_blank" rel="noopener noreferrer">
                <strong>{{ pr.title }}</strong>
              </a>
              <span>Merged on {{ pr.merged_at }} by <a href="{{ pr.user_url }}" target="_blank" rel="noopener noreferrer">{{ pr.user }}</a></span>
            </li>
          {% else %}
            <li>Could not load recent changes. Probably for the best.</li>
          {% endfor %}
        </ul>
      </div>
    {% endcall %}

    <footer>
      {{ button('about', id='open-about-modal', outline=True) }}
      {{ button('donate', id='open-donate-modal', outline=True) }}
      {{ button('settings', id='open-settings-modal', outline=True) }}
    </footer>
  </body>
</html>
